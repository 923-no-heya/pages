<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>9 × 2 = 3 の部屋</title>
  <meta name="description" content="" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#fafafa; --surface:#fff; --ink:#1f2937; --muted:#6b7280; --line:#e5e7eb;
      --brand:#3b82f6; --brand-2:#06b6d4; --radius:20px; --shadow:0 8px 20px rgba(0,0,0,.06); --max:1200px;
      --chip:#f3f4f6; --chip-hover:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.65 Inter,"Noto Sans JP",sans-serif;color:var(--ink);background:var(--bg)}
    a{text-decoration:none;color:inherit}
    .container{max-width:var(--max);margin:0 auto;padding:0 32px}

    /* Header（ガラス・透過） */
    header{
      position:sticky;top:0;z-index:60;
      background:rgba(255,255,255,.6);
      backdrop-filter:saturate(160%) blur(10px);
      -webkit-backdrop-filter:saturate(160%) blur(10px);
      border-bottom:1px solid rgba(229,231,235,.7);
    }
    .nav{display:flex;align-items:center;gap:16px;padding:12px 32px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand svg{width:24px;height:24px;display:block}
    .brand span{
      font-weight:800;font-size:18px;
      background:linear-gradient(90deg,var(--brand),var(--brand-2));
      -webkit-background-clip:text;background-clip:text;
      color:transparent;-webkit-text-fill-color:transparent;
    }
    .spacer{flex:1}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{
      padding:8px 14px;border-radius:999px;
      font-weight:600;transition:.2s;
      background:rgba(255,255,255,.7); border:1px solid var(--line); color:var(--ink)
    }
    .tab:hover{background:#fff}
    .tab[aria-current="page"]{background:linear-gradient(90deg,var(--brand),var(--brand-2));color:#fff;border-color:transparent}
    .menuButton{display:none;background:none;border:none;cursor:pointer}
    .menuIcon{width:24px;height:2px;background:var(--ink);position:relative;display:block}
    .menuIcon::before,.menuIcon::after{content:"";position:absolute;left:0;width:24px;height:2px;background:var(--ink);}
    .menuIcon::before{top:-7px}
    .menuIcon::after{top:7px}
    @media(max-width:820px){.tabs{display:none}.menuButton{display:inline-flex;align-items:center;justify-content:center;padding:8px}}

    /* Drawer（明るい＋閉じる） */
    .drawer{
      position:fixed;inset:0 0 0 auto;width:80%;max-width:320px;transform:translateX(100%);
      background:rgba(255,255,255,.96); box-shadow:var(--shadow); transition:.25s;
      display:flex;flex-direction:column;padding:20px;gap:12px;z-index:70;
      backdrop-filter:saturate(160%) blur(8px);
    }
    .drawer.open{transform:translateX(0)}
    .drawer a{
      padding:12px;border-radius:10px;background:#f8fafc;border:1px solid var(--line);
      display:flex;align-items:center;gap:10px;
    }
    .drawer a:hover{background:#fff}
    .drawerClose{align-self:flex-end;background:none;border:none;font-size:32px;line-height:1;color:var(--ink);cursor:pointer;padding:8px;margin:-8px -8px 8px auto;}
    .drawerClose:hover{color:var(--brand)}
    .ico{width:18px;height:18px;flex:0 0 18px;display:inline-block}
    .ico svg{width:18px;height:18px;display:block}
    .ico path,.ico rect,.ico circle,.ico polyline,.ico line{stroke:var(--brand);stroke-width:1.8;fill:none;stroke-linecap:round;stroke-linejoin:round}

    /* Hero */
    main{min-height:70vh}
    .hero{position:relative;color:#fff;text-align:center;padding:120px 32px 96px;overflow:hidden}
    .hero-background{position:absolute;inset:-10% 0 0 0;width:100%;height:120%;object-fit:cover;z-index:-1;filter:brightness(0.6)}
    .hero h1{
      font-size:clamp(32px,6vw,52px);margin:0 0 12px;font-weight:800;
      color:#fff !important;text-shadow:0 2px 10px rgba(0,0,0,.25);
    }
    .ctaRow{margin-top:22px;display:flex;justify-content:center;gap:12px;flex-wrap:wrap}
    .btn{padding:12px 18px;border-radius:12px;font-weight:700;transition:.2s;display:inline-block}
    .btn.primary{background:#fff;color:var(--brand)}
    .btn.secondary{background:rgba(255,255,255,.2);color:#fff;border:1px solid #fff}
    .btn:hover{opacity:.9}

    /* Sections / Cards */
    .catSection{padding:60px 32px;position:relative}
    .catHeader{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;margin:0 0 24px}
    .catHeader h2{
      margin:0;font-size:28px;font-weight:800;
      background:linear-gradient(90deg,var(--brand),var(--brand-2));-webkit-background-clip:text;background-clip:text;color:transparent
    }
    .catHeader p{flex-basis:100%;margin:8px 0 0;color:var(--muted)}
    .viewAll{padding:8px 14px;border-radius:999px;border:1px solid var(--line);background:#fff;color:var(--brand);font-weight:600}
    .cardGrid{display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}

    /* Card */
    .card{background:var(--surface);border-radius:16px;box-shadow:var(--shadow);padding:22px;display:flex;flex-direction:column;gap:8px;transition:all .2s ease}
    .card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.1)}
    .cardTitle{margin:0;font-size:20px;font-weight:700}
    .cardDesc{color:var(--muted);display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}

    /* 控えめリンク（本文を見る / 記事一覧） */
    .cardMore{
      margin-top:auto;
      color:var(--brand); 
      font-weight:600;
      font-size:14px;
      letter-spacing:.02em;
      display:inline-flex;align-items:center;gap:6px;
      transition:color .2s ease, transform .2s ease;
    }
    .card:hover .cardMore{color:var(--brand)}
    .cardMore::after{content:"›";transform:translateY(1px)}

    /* PDF list（説明文つき） */
    .pdfList{list-style:none;padding:0;margin:0;display:grid;gap:10px}
    .pdfList li a{
      display:block;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#f9fafb
    }
    .pdfTitle{font-weight:700;margin:0 0 4px;font-size:16px}
    .pdfDesc{color:var(--muted);font-size:14px;line-height:1.6;
      display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}

    /* パンくず非表示 */
    .breadcrumbs{display:none!important}

    /* Footer */
    footer{padding:32px;text-align:center;color:var(--muted);background:#f3f4f6;margin-top:60px}
  </style>
</head>
<body>
  <header>
    <nav class="nav container">
      <a class="brand" href="#/" aria-label="トップへ">
        <!-- SVGロゴ（グラデ線の折れ線グラフ） -->
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <defs>
            <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#3b82f6"/>
              <stop offset="100%" stop-color="#06b6d4"/>
            </linearGradient>
          </defs>
        <path d="M3 3v18h18" fill="none" stroke="url(#g1)" stroke-width="2" stroke-linecap="round"/>
        <path d="M6 15l4-4 3 3 5-7" fill="none" stroke="url(#g1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="6" cy="15" r="1.5" fill="url(#g1)"/>
        <circle cx="10" cy="11" r="1.5" fill="url(#g1)"/>
        <circle cx="13" cy="14" r="1.5" fill="url(#g1)"/>
        <circle cx="18" cy="7" r="1.5" fill="url(#g1)"/>
        </svg>
        <span>9 × 2 = 3 の部屋</span>
      </a>
      <div class="spacer"></div>
      <div class="tabs" id="tabs"></div>
      <button class="menuButton" id="menuBtn" aria-label="メニュー"><span class="menuIcon"></span></button>
    </nav>
  </header>

  <aside id="drawer" class="drawer">
    <button id="drawerClose" class="drawerClose" aria-label="閉じる">&times;</button>
  </aside>

  <main id="app"></main>

  <footer>© <span id="year"></span> 9×2=3の部屋<br>Kunihiro Suzuki</footer>

  <!-- サイトデータ -->
  <script src="site-data.js"></script>

  <script>
    const $ = s => document.querySelector(s);

    /* ==== Routing ==== */
    function route(){
      window.scrollTo({top:0,left:0,behavior:'auto'});
      const hash=location.hash||"#/";
      const app=$("#app");
      const [,root,p1,p2]=hash.split("/");
      if(root===""||root==="#"){renderHome(app);highlightTab('#/');return}
      if(root==="category"&&p1&&!p2){renderCategory(app,p1);highlightTab(`#/category/${p1}`);return}
      if(root==="subcategory"&&p1&&p2){renderSubcategory(app,p1,p2);highlightTab(`#/category/${p1}`);return}
      if(root==="article"&&p1){renderArticle(app,p1);return}
      app.innerHTML="<p style='padding:40px'>ページが見つかりません</p>";
    }

    function highlightTab(path){
      document.querySelectorAll('.tabs .tab').forEach(a=>{
        a.removeAttribute('aria-current');
        if(a.getAttribute('href')===path){a.setAttribute('aria-current','page');}
      });
    }

    /* ==== Common UI ==== */
    function buildMenus(){
      const tabsHTML=`
        <a class="tab" href="#/">トップ</a>
        <a class="tab" href="#/category/stat">統計学</a>
        <a class="tab" href="#/category/math">数学</a>
        <a class="tab" href="#/category/queue">待ち行列</a>
        <a class="tab" href="#/category/semiconductor">半導体</a>
        <a class="tab" href="#/category/others">その他の解析</a>
        <a class="tab" href="#/category/melas">走れメラス</a>
        <a class="tab" href="#/category/memoir">手記</a>`;
      $("#tabs").innerHTML=tabsHTML;

      // --- モバイルドロワー（各項目アイコン付き） ---
      const drawerHTML=`
        <button id="drawerClose" class="drawerClose" aria-label="閉じる">&times;</button>

        <a href="#/">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M3 10L12 3l9 7"/><path d="M5 10v10h5v-6h4v6h5V10"/></svg>
          </span>トップ
        </a>

        <a href="#/category/stat">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><rect x="4" y="10" width="3" height="8"/><rect x="10" y="6" width="3" height="12"/><rect x="16" y="3" width="3" height="15"/></svg>
          </span>統計学
        </a>

        <a href="#/category/math">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 12h16"/><path d="M8 6h8"/><path d="M8 18h8"/></svg>
          </span>数学
        </a>

        <a href="#/category/queue">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><line x1="4" y1="18" x2="20" y2="18"/><circle cx="6" cy="12" r="1.5"/><circle cx="10" cy="12" r="1.5"/><circle cx="14" cy="12" r="1.5"/></svg>
          </span>待ち行列
        </a>

        <a href="#/category/semiconductor">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <rect x="6" y="6" width="12" height="12" rx="2"/>
              <line x1="9" y1="2" x2="9" y2="6"/><line x1="15" y1="2" x2="15" y2="6"/>
              <line x1="2" y1="9" x2="6" y2="9"/><line x1="2" y1="15" x2="6" y2="15"/>
              <line x1="18" y1="9" x2="22" y2="9"/><line x1="18" y1="15" x2="22" y2="15"/>
              <line x1="9" y1="18" x2="9" y2="22"/><line x1="15" y1="18" x2="15" y2="22"/>
            </svg>
          </span>半導体
        </a>

        <a href="#/category/others">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M6 2l4 8v8a2 2 0 0 1-2 2h-2"/><path d="M18 2l-4 8v8a2 2 0 0 0 2 2h2"/></svg>
          </span>その他の解析
        </a>

        <a href="#/category/melas">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 20l8-8"/><path d="M14 6l4 4"/><path d="M12 8l4 4"/></svg>
          </span>走れメラス
        </a>

        <a href="#/category/memoir">
          <span class="ico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M4 4h12a4 4 0 0 1 4 4v12"/><path d="M4 4v16a3 3 0 0 1 3-3h13"/></svg>
          </span>手記
        </a>`;
      $("#drawer").innerHTML=drawerHTML;
    }

    /* ===== Cards ===== */
    function SubcatCard(parentKey,sc){
      return `<a class="card" href="#/subcategory/${parentKey}/${sc.key}">
          <h3 class="cardTitle">${sc.label}</h3>
          <div class="cardDesc">${sc.summary||''}</div>
          <span class="cardMore">記事一覧</span>
        </a>`;
    }

    function ArticleCard(a){
      const inner=`<h3 class="cardTitle">${a.title}</h3>
        <div class="cardDesc">${a.description||''}</div>
        <span class="cardMore">本文を見る</span>`;
      return a.url?`<a class="card" href="${a.url}" rel="noopener">${inner}</a>`:`<a class="card" href="#/article/${a.id||''}">${inner}</a>`;
    }

    /* ===== Home ===== */
    function renderHome(app){
      let html=`
        <section class="hero">
          <img src="https://kunisan-assets.s3.ap-northeast-1.amazonaws.com/%E3%82%B9%E3%82%A4%E3%82%B9.jpg" alt="著者と牛の写真" class="hero-background" id="hero-bg">
          <h1>${SITE.title}</h1>
          <div class="ctaRow">
            <a class="btn secondary" href="https://kunisan-assets.s3.ap-northeast-1.amazonaws.com/%E8%91%97%E8%80%85%E7%95%A5%E6%AD%B4.pdf">著者略歴</a>
          </div>
        </section>`;

      const hideViewAllKeys=new Set(["stat","math","memoir","others","queue","semiconductor"]);

      html+=SITE.categories.map(c=>{
        let inner="";
        if(c.subcategories){
          inner=c.subcategories.map(sc=>SubcatCard(c.key,sc)).join("");
        }else if(c.articles){
          const list=c.key==="melas"?c.articles.slice(-3).reverse():c.articles;
          inner=list.map(ArticleCard).join("");
        }
        return `<section class="catSection container" id="${c.key}">
            <div class="catHeader">
              <h2>${c.label}</h2>
              ${hideViewAllKeys.has(c.key)?"":`<a class="viewAll" href="#/category/${c.key}">すべて見る</a>`}
              <p>${c.summary||''}</p>
            </div>
            <div class="cardGrid">${inner||`<div class="card"><h3 class="cardTitle">コンテンツがありません</h3><div class="cardDesc">公開までお待ちください。</div></div>`}</div>
          </section>`;
      }).join("");

      app.innerHTML=html;

      // ヒーロー軽いパララックス
      const bg=document.getElementById('hero-bg');
      if(bg){
        const onScroll=()=>{bg.style.transform=`translateY(${(window.scrollY||0)*0.15}px)`;};
        window.addEventListener('scroll',onScroll,{passive:true});
        renderHome._cleanup=()=>window.removeEventListener('scroll',onScroll);
      }
    }

    /* ===== Category page ===== */
    function renderCategory(app,key){
      if(renderHome._cleanup){try{renderHome._cleanup();}catch(e){}}
      const cat=SITE.categories.find(c=>c.key===key);
      if(!cat){app.innerHTML="<p>カテゴリが見つかりません</p>";return}

      if(cat.subcategories){
        app.innerHTML=`<section class="catSection container">
            <div class="catHeader">
              <h2>${cat.label}</h2>
              <p>${cat.summary||''}</p>
            </div>
            <div class="cardGrid">
              ${cat.subcategories.map(sc=>SubcatCard(cat.key,sc)).join('')}
            </div>
          </section>`;
        return;
      }

      const list=cat.articles||[];
      app.innerHTML=`<section class="catSection container">
          <div class="catHeader">
            <h2>${cat.label}</h2>
            <p>${cat.summary||''}</p>
          </div>
          <div class="cardGrid">
            ${list.map(ArticleCard).join('')}
          </div>
        </section>`;
    }

    /* ===== Subcategory page ===== */
    function renderSubcategory(app,parentKey,subKey){
      if(renderHome._cleanup){try{renderHome._cleanup();}catch(e){}}

      const cat=SITE.categories.find(c=>c.key===parentKey);
      if(!cat){app.innerHTML="<p>セクションが見つかりません</p>";return;}

      let level=1,parentSC=null;
      let node=(cat.subcategories||[]).find(s=>s.key===subKey)||null;

      if(!node&&cat.subcategories){
        for(const sc of cat.subcategories){
          const child=(sc.children||[]).find(ch=>ch.key===subKey);
          if(child){level=2;parentSC=sc;node=child;break;}
        }
      }
      if(!node){app.innerHTML="<p>セクションが見つかりません</p>";return;}

      if(level===1&&Array.isArray(node.children)&&node.children.length){
        app.innerHTML=`<section class='catSection container'>
            <div class='catHeader'>
              <h2>${node.label}</h2>
              <p>${node.summary||cat.summary||''}</p>
            </div>
            <div class="cardGrid">
              ${node.children.map(ch=>`
                <a class="card" href="#/subcategory/${cat.key}/${ch.key}">
                  <h3 class="cardTitle">${ch.label}</h3>
                  <div class="cardDesc">${ch.summary||''}</div>
                  <span class="cardMore">記事一覧</span>
                </a>
              `).join('')}
            </div>
          </section>`;
        return;
      }

      const articles=node.articles||[];
      app.innerHTML=`<section class='catSection container'>
          <div class='catHeader'>
            <h2>${node.label}</h2>
            <p>${node.summary||cat.summary||''}</p>
          </div>
          <ul class='pdfList'>
            ${
              articles.map(item=>`
                <li>
                  <a href='${item.url}' rel='noopener'>
                    <div class="pdfTitle">${item.title}</div>
                    <div class="pdfDesc">${item.description || ''}</div>
                  </a>
                </li>
              `).join('')
            }
          </ul>
        </section>`;
    }

    /* ===== (legacy) Internal Article page ===== */
    function renderArticle(app,id){
      const cat=SITE.categories.find(c=>(c.articles||[]).some(a=>a.id===id));
      const a=cat?.articles?.find(x=>x.id===id);
      if(!a){app.innerHTML="<p>記事が見つかりません</p>";return}
      app.innerHTML=`<article class='container'><h1>${a.title}</h1><div>${a.body||''}</div></article>`;
    }

    /* ===== Drawer ===== */
    const drawer=$("#drawer"),menuBtn=$("#menuBtn");
    menuBtn.addEventListener("click",()=>drawer.classList.toggle("open"));
    drawer.addEventListener("click",e=>{if(e.target.tagName==="A")drawer.classList.remove("open")});
    drawer.addEventListener("click",e=>{if(e.target.id==="drawerClose")drawer.classList.remove("open")});

    window.addEventListener("hashchange",route);
    window.addEventListener("DOMContentLoaded",()=>{
      if(!window.SITE){console.error("SITE が見つかりません。先に site-data.js を読み込んでください。");}
      buildMenus();
      route();
      $("#year").textContent=new Date().getFullYear();
    });
  </script>
</body>
</html>
