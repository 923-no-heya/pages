<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>9 × 2 = 3 の部屋</title>
  <meta name="description" content="" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fafafa; --surface:#fff; --ink:#1f2937; --muted:#6b7280; --line:#e5e7eb;
      --brand:#3b82f6; --brand-2:#06b6d4; --radius:20px; --shadow:0 8px 20px rgba(0,0,0,.06); --max:1200px;
    }
    body{margin:0;font:16px/1.65 Inter,"Noto Sans JP",sans-serif;color:var(--ink);background:var(--bg)}
    a{text-decoration:none;color:inherit}
    .container{max-width:var(--max);margin:0 auto;padding:0 32px}

    /* Header */
    header{background:var(--surface);box-shadow:var(--shadow);position:sticky;top:0;z-index:50}
    .nav{display:flex;align-items:center;gap:16px;padding:16px 32px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:800;font-size:18px;color:var(--brand)}
    .logo{display:inline-block}
    .spacer{flex:1}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 14px;border-radius:10px;font-weight:600;color:var(--ink);transition:.2s;background:#f3f4f6}
    .tab:hover{background:#e5e7eb}
    .tab[aria-current="page"]{background:var(--brand);color:#fff}
    .menuButton{display:none;background:none;border:none;cursor:pointer}
    .menuIcon{width:24px;height:2px;background:var(--ink);position:relative;display:block}
    .menuIcon::before,.menuIcon::after{content:"";position:absolute;left:0;width:24px;height:2px;background:var(--ink);}
    .menuIcon::before{top:-7px}
    .menuIcon::after{top:7px}
    @media(max-width:820px){.tabs{display:none}.menuButton{display:inline-flex;align-items:center;justify-content:center;padding:8px}}

    /* Drawer */
    .drawer{position:fixed;inset:0 0 0 auto;width:80%;max-width:320px;transform:translateX(100%);background:var(--surface);box-shadow:var(--shadow);transition:.25s;display:flex;flex-direction:column;padding:20px;gap:12px;z-index:60}
    .drawer.open{transform:translateX(0)}
    .drawer a{padding:12px;border-radius:8px;background:#f3f4f6}

    /* Hero */
    main{min-height:70vh}
    .hero{position:relative;color:#fff;text-align:center;padding:120px 32px}
    .hero-background{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:-1;filter:brightness(0.6)}
    .hero h1{font-size:clamp(32px,6vw,52px);margin:0 0 16px;font-weight:800}
    .ctaRow{margin-top:28px;display:flex;justify-content:center;gap:16px;flex-wrap:wrap}
    .btn{padding:12px 20px;border-radius:12px;font-weight:700;transition:.2s}
    .btn.primary{background:#fff;color:var(--brand)}
    .btn.secondary{background:rgba(255,255,255,.2);color:#fff;border:1px solid #fff}
    .btn:hover{opacity:.9}

    /* Category Sections */
    .catSection{padding:60px 32px;position:relative}
    .catHeader{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;margin:0 0 24px}
    .catHeader h2{margin:0;font-size:28px;font-weight:800;background:linear-gradient(90deg,var(--brand),var(--brand-2));-webkit-background-clip:text;background-clip:text;color:transparent}
    .catHeader p{flex-basis:100%;margin:8px 0 0;color:var(--muted)}
    .viewAll{padding:8px 14px;border-radius:8px;border:1px solid var(--line);background:#f9fafb;color:var(--brand);font-weight:600}
    .articleGrid{display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .aCard{background:var(--surface);border-radius:16px;box-shadow:var(--shadow);padding:22px;display:flex;flex-direction:column;gap:8px;transition:all .2s ease}
    .aCard:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.1)}
    .aCard h3{margin:0;font-size:20px}
    .aCard .desc{color:var(--muted)}
    .aCard .more{margin-top:auto;color:var(--brand);font-weight:700}

    /* Subcategory Cards */
    .subcatGrid{display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .scCard{background:var(--surface);padding:20px;border-radius:16px;box-shadow:var(--shadow);transition:.2s}
    .scCard:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,0,0,.1)}
    .scCard h3{margin:0 0 8px;font-size:18px;font-weight:700;color:var(--brand)}
    .scCard p{margin:0;color:var(--muted);font-size:14px}

    /* Lists for PDFs */
    .pdfList{list-style:none;padding:0;margin:0;display:grid;gap:10px}
    .pdfList li a{display:block;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#f9fafb}

    /* List / Article pages */
    .list{display:grid;gap:12px;padding:24px}
    .row{padding:16px;border-radius:12px;background:#f3f4f6;transition:.2s}
    .row:hover{background:#e5e7eb}
    .rowTitle{font-weight:700}
    .rowMeta{font-size:12px;color:var(--muted)}
    article{background:var(--surface);box-shadow:var(--shadow);padding:36px;border-radius:var(--radius);margin:24px}
    .breadcrumbs{font-size:12px;color:var(--muted);margin-bottom:12px}

    /* Footer */
    footer{padding:32px;text-align:center;color:var(--muted);background:#f3f4f6;margin-top:60px}
  </style>
</head>
<body>
  <header>
    <nav class="nav container">
      <a class="brand" href="#/">
        <svg class="logo" width="28" height="28" viewBox="0 0 28 28" aria-hidden="true">
          <rect x="1" y="1" width="26" height="26" rx="8" fill="url(#g)"/>
          <g stroke="white" stroke-linecap="round" stroke-width="1.6">
            <path d="M6 20 C10 16 14 14 22 10" opacity=".85"/>
            <circle cx="8" cy="18" r="1.6" fill="white"/>
            <circle cx="13" cy="15" r="1.6" fill="white"/>
            <circle cx="18" cy="13" r="1.6" fill="white"/>
            <circle cx="22" cy="10" r="1.6" fill="white"/>
          </g>
          <defs>
            <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
              <stop offset="0%" stop-color="#3b82f6"/>
              <stop offset="100%" stop-color="#06b6d4"/>
            </linearGradient>
          </defs>
        </svg>
        <span>9 × 2 = 3 の部屋</span>
      </a>
      <div class="spacer"></div>
      <div class="tabs">
        <a class="tab" href="#/">トップ</a>
        <a class="tab" href="#/category/stat">統計学</a>
        <a class="tab" href="#/category/math">数学</a>
        <a class="tab" href="#/category/others">その他の解析</a>
        <a class="tab" href="#/category/melas">走れメラス</a>
        <a class="tab" href="#/category/memoir">手記</a>
      </div>
      <button class="menuButton" id="menuBtn" aria-label="メニュー"><span class="menuIcon"></span></button>
    </nav>
  </header>

  <aside id="drawer" class="drawer">
    <a href="#/">トップ</a>
    <a href="#/category/stat">統計学</a>
    <a href="#/category/math">数学</a>
    <a href="#/category/others">その他の解析</a>
    <a href="#/category/melas">走れメラス</a>
    <a href="#/category/memoir">手記</a>
  </aside>

  <main id="app"></main>

  <footer>© <span id="year"></span> 9 × 2 = 3 の部屋</footer>

  <!-- 外部データ -->
  <script src="site-data.js"></script>

  <script>
    const $=s=>document.querySelector(s);

    function SubcatCard(catKey, sc){
      return `
        <a class="scCard" href="#/subcategory/${catKey}/${sc.key}">
          <h3>${sc.label}</h3>
          <p>${sc.summary || ''}</p>
        </a>`;
    }

    function route(){
      const hash=location.hash||"#/";
      const app=$("#app");
      const [,root,p1,p2] = hash.split("/");
      if(root===""||root==="#"){renderHome(app);return}
      if(root==="category" && p1 && !p2){renderCategory(app,p1);return}
      if(root==="subcategory" && p1 && p2){renderSubcategory(app,p1,p2);return}
      if(root==="article" && p1){renderArticle(app,p1);return}
      app.innerHTML="<p style='padding:40px'>ページが見つかりません</p>";
    }

    function renderHome(app){
      let html=`<section class="hero">
        <img src="https://kunisan-assets.s3.ap-northeast-1.amazonaws.com/%E3%82%B9%E3%82%A4%E3%82%B9.jpg" alt="著者と牛の写真" class="hero-background">
        <h1>${SITE.title}</h1>
        <div class="ctaRow"><a class="btn primary" href="#/category/stat">統計学から始める</a><a class="btn secondary" href="#/category/math">数学へ</a></div>
      </section>`;

      html+= SITE.categories.map(c=>{
        if(c.subcategories){
          return `
            <section class='catSection container' id='${c.key}'>
              <div class='catHeader'>
                <h2>${c.label}</h2>
                <a href='#/category/${c.key}' class='viewAll'>すべて見る</a>
                <p>${c.summary || ''}</p>
              </div>
              <div class="subcatGrid">
                ${c.subcategories.map(sc=>SubcatCard(c.key, sc)).join('')}
              </div>
            </section>`;
        }else{
          return `
            <section class='catSection container' id='${c.key}'>
              <div class='catHeader'>
                <h2>${c.label}</h2>
                <a href='#/category/${c.key}' class='viewAll'>すべて見る</a>
                <p>${c.summary || ''}</p>
              </div>
              <div class='articleGrid'>
                ${(c.articles||[]).map(a=>ArticleCard(a)).join('')}
              </div>
            </section>`;
        }
      }).join("");
      app.innerHTML=html;
    }

    function ArticleCard(a){
      const inner = `
        <h3>${a.title}</h3>
        <div class='desc'>${a.description || ''}</div>
        <span class='more'>本文を見る →</span>`;
      if(a._external || a.url){
        return `<a class='aCard' href='${a.url}' target='_blank' rel='noopener'>${inner}</a>`;
      }
      return `<a class='aCard' href='#/article/${a.id}'>${inner}</a>`;
    }

    function renderCategory(app,key){
      const cat = SITE.categories.find(c=>c.key===key);
      if(!cat){app.innerHTML="<p>カテゴリが見つかりません</p>";return}
      if(cat.subcategories){
        app.innerHTML = `
          <section class='catSection container'>
            <div class='catHeader'>
              <h2>${cat.label}</h2>
              <p>${cat.summary||''}</p>
            </div>
            <div class="subcatGrid">
              ${cat.subcategories.map(sc=>SubcatCard(cat.key, sc)).join('')}
            </div>
          </section>`;
        return;
      }
      const list=(cat.articles||[]);
      app.innerHTML=`
        <section class='catSection container'>
          <div class='catHeader'>
            <h2>${cat.label}</h2>
            <p>${cat.summary||''}</p>
          </div>
          <div class='articleGrid'>
            ${list.map(ArticleCard).join('')}
          </div>
        </section>`;
    }

    function renderSubcategory(app,parentKey,subKey){
      const cat = SITE.categories.find(c=>c.key===parentKey);
      const sc = cat?.subcategories?.find(s=>s.key===subKey);
      if(!cat || !sc){app.innerHTML="<p>セクションが見つかりません</p>";return}
      app.innerHTML = `
        <div class='breadcrumbs container'><a href='#/'>トップ</a> › <a href='#/category/${cat.key}'>${cat.label}</a> › ${sc.label}</div>
        <section class='catSection container'>
          <div class='catHeader'>
            <h2>${sc.label}</h2>
            <p>${sc.summary||cat.summary||''}</p>
          </div>
          <ul class='pdfList'>
            ${sc.articles.map(item=>`<li><a href='${item.url}' target='_blank' rel='noopener'>${item.title}</a></li>`).join('')}
          </ul>
        </section>`;
    }

    function renderArticle(app,id){
      const cat = SITE.categories.find(c=> (c.articles||[]).some(a=>a.id===id));
      const a = cat?.articles?.find(x=>x.id===id);
      if(!a){app.innerHTML="<p>記事が見つかりません</p>";return}
      app.innerHTML=`
        <div class='breadcrumbs container'><a href='#/'>トップ</a> › <a href='#/category/${cat.key}'>${cat.label}</a> › ${a.title}</div>
        <article class='container'><h1>${a.title}</h1><div>${a.body||''}</div></article>`;
    }

    const drawer=$("#drawer"),menuBtn=$("#menuBtn");
    menuBtn.addEventListener("click",()=>drawer.classList.toggle("open"));
    drawer.addEventListener("click",e=>{if(e.target.tagName==="A")drawer.classList.remove("open")});

    window.addEventListener("hashchange",route);
    window.addEventListener("DOMContentLoaded",()=>{route();$("#year").textContent=new Date().getFullYear()});
  </script>
</body>
</html>
